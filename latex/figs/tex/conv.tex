\begin{tikzpicture}[x={(0.866cm,0.5cm)}, y={(-0.866cm,0.5cm)}, z={(0cm,1cm)}, scale=0.7]

  \begin{scope}[canvas is xz plane at y=0,transform shape]
    \foreach \ii [count = \xi] in {-3,-2,...,3}{
      \foreach \jj  [count = \yi] in {-3,-2,...,3}{
        \pgfmathsetmacro{\num}{int(abs(\ii)+abs(\jj)+1)}
        \node[draw=black!30!pagecolor,fill=black!5!pagecolor,text=textcolor,minimum size=1cm] (n-1-\xi-\yi) at (\xi,-\yi) {\LARGE \num};
      }
    }
    \foreach \ii [count = \xi] in {-3,-2,-1}{
      \foreach \jj [count = \yi] in {-3,-2,-1}{
        \pgfmathsetmacro{\num}{int(abs(\ii)+abs(\jj)+1)}
        \node[draw=blue!20!pagecolor,fill=blue!10!pagecolor,minimum size=1cm] (n-1-\xi-\yi) at (\xi,-\yi) {\LARGE \num}; % rename nodes
      }
    }

    \path[draw=black,thick] (n-1-1-1.north west) -- (n-1-7-1.north east) -- (n-1-7-7.south east) -- (n-1-1-7.south west) -- cycle;
    \path[draw=blue] (n-1-1-1.north west) -- (n-1-3-1.north east) -- (n-1-3-3.south east) -- (n-1-1-3.south west) -- cycle;


  \end{scope}

  \begin{scope}[canvas is xz plane at y=-7.3,transform shape]
    \foreach \ii [count = \xi] in {-1,0,1}{
      \foreach \jj  [count = \yi]in {-1,0,1}{
        \pgfmathsetmacro{\num}{int(\ii)}
        \node[draw=blue!20!pagecolor,fill=blue!10!pagecolor,text=textcolor,minimum size=1cm] (n-2-\xi-\yi) at (\xi,-\yi) {\LARGE \num};
      }
    }

    \path[draw=blue] (n-2-1-1.north west) -- (n-2-3-1.north east) -- (n-2-3-3.south east) -- (n-2-1-3.south west) -- cycle;
  \end{scope}

  \begin{scope}[canvas is xz plane at y=-11.2,transform shape]
    \foreach \ii [count = \xi] in {1,2,3,...,7}{
      \foreach \jj  [count = \yi]in {1,2,3,...,7}{
        \node[draw=black!30!pagecolor,fill=black!5!pagecolor,text=textcolor,minimum size=1cm] (n-3-\xi-\yi) at (\xi,-\yi) {};
      }
    }

    \foreach \ii [count = \xi] in {-3,-2,-1}{
      \foreach \jj [count = \yi] in {-3,-2,-1}{
        \pgfmathsetmacro{\num}{int(abs(min(\ii,\jj))}
        \node[draw=blue!20!pagecolor,fill=blue!10!pagecolor,minimum size=1cm] (n-3-\xi-\yi) at (\xi,-\yi) {}; % rename nodes
      }
    }

    \path[draw=blue,dashed] (n-3-1-1.north west) -- (n-3-3-1.north east) -- (n-3-3-3.south east) -- (n-3-1-3.south west) -- cycle;
    \path[thick,draw=black] (n-3-2-2.north west) -- (n-3-6-2.north east) -- (n-3-6-6.south east) -- (n-3-2-6.south west) -- cycle;
  \end{scope}

  % red box
  \path[draw=red,fill=red!50,opacity=0.3] (n-1-2-2.north east) -- (n-2-2-2.north east) -- (n-3-2-2.north east) -- (n-3-2-2.north west) -- (n-2-2-2.north west) -- (n-1-2-2.north west); % top
  \path[draw=red,fill=red!50,opacity=0.3] (n-1-2-2.south east) -- (n-2-2-2.south east) -- (n-3-2-2.south east) -- (n-3-2-2.south west) -- (n-2-2-2.south west) -- (n-1-2-2.south west); % bottom
  \path[draw=red,fill=red!50,opacity=0.3] (n-1-2-2.north east) -- (n-2-2-2.north east) -- (n-3-2-2.north east) -- (n-3-2-2.south east) -- (n-2-2-2.south east) -- (n-1-2-2.south east); % right
  \path[draw=red,fill=red!50,opacity=0.3] (n-1-2-2.north west) -- (n-2-2-2.north west) -- (n-3-2-2.north west) -- (n-3-2-2.south west) -- (n-2-2-2.south west) -- (n-1-2-2.south west); % left


  % blue lines connecting
  \path[draw=blue!40!pagecolor] (n-1-1-3.south west) -- (n-2-1-3.south west) -- (n-3-1-3.south west);
  \path[draw=blue!40!pagecolor] (n-1-3-1.north east) -- (n-2-3-1.north east) -- (n-3-3-1.north east);

  \begin{scope}[canvas is xz plane at y=0,transform shape]
    \node[yshift=1.2cm,black] (rf-tag) at (n-1-4-1.north) {\LARGE urspr√ºngliches Bild $\mat{B}$};
    \node[draw=red,minimum size=1cm] (marked1) at (2,-2) {\LARGE 5};
    \node[yshift=0.5cm,blue] (rf-tag) at (n-1-2-1.north) {\large Rezeptives Feld $\hat{\mat{B}}^{(2,2)}$};
    \node[xshift=-0.5cm,red,rotate=90] (rf-tag) at (n-1-1-2.west) {\large Quellenpixel $(\mat{B})_S$};
  \end{scope}

  \begin{scope}[canvas is xz plane at y=-7.3,transform shape]
    \node[draw=red,text=textcolor,minimum size=1cm] (marked2) at (2,-2) {\LARGE 0};
    \node[yshift=0.5cm,blue] (rf-tag) at (n-2-2-1.north) {\large Filter $\mat{F}$};
    \node[xshift=-0.5cm,red,rotate=90] (rf-tag) at (n-2-1-2.west) {Zentralelement $(\mat{F})_C$};
  \end{scope}

  \begin{scope}[canvas is xz plane at y=-11.2,transform shape]
    \node[yshift=0.5cm,black] (rf-tag) at (n-3-4-2.north) {\LARGE neues Bild $\tilde{\mat{B}}$};
    \node[draw=red,fill=blue!10!white,text=textcolor,minimum size=1cm] (marked3) at (2,-2) {\LARGE -6};
  \end{scope}

  \node[] at (9,-5,0) {%
    $\begin{aligned}
      &\hat{\mat{B}}^{(2,2)} \odot \mat{F} =\\
      &(7 \cdot -1) + (6 \cdot 0) + (5 \cdot 1) +\\
      &(6 \cdot -1) + (5 \cdot 0) + (4 \cdot 1) +\\
      &(5 \cdot -1) + (4 \cdot 0) + (3 \cdot 1) \\
      &=-6
    \end{aligned}$};

\end{tikzpicture}
%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../figs"
%%% End:
